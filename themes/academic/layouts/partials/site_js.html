{{/* Minimal JS partial for Academic theme, with manual dark-mode toggle */}}
{{- $scr := .Scratch -}}

{{/* Core theme JS (bundled by Academic) */}}
<script src="{{ "/js/academic.min.js" | relURL }}"></script>

<script>
  // Simple dark-mode toggler, independent of old Academic wiring.
  document.addEventListener('DOMContentLoaded', function () {
    var toggle = document.querySelector('.js-dark-toggle');
    if (!toggle) return;

    var root = document.documentElement;
    var storageKey = 'wcTheme';

    function applyTheme(theme) {
      if (theme === 'dark') {
        root.classList.add('dark');
        root.dataset.theme = 'dark';
        if (document.body) document.body.classList.add('dark');
      } else {
        root.classList.remove('dark');
        root.dataset.theme = 'light';
        if (document.body) document.body.classList.remove('dark');
      }
    }

    // Initial theme from localStorage or OS preference.
    var stored = localStorage.getItem(storageKey);
    if (!stored) {
      stored = (window.matchMedia &&
                window.matchMedia('(prefers-color-scheme: dark)').matches)
               ? 'dark' : 'light';
    }
    applyTheme(stored);

    // Click handler on the moon/sun icon.
    toggle.addEventListener('click', function (e) {
      e.preventDefault();
      var currentIsDark =
        root.classList.contains('dark') ||
        (document.body && document.body.classList.contains('dark'));
      var next = currentIsDark ? 'light' : 'dark';
      localStorage.setItem(storageKey, next);
      applyTheme(next);
    });
  });
</script>

{{/* Optional hook if you ever create layouts/partials/custom_js.html */}}
{{ partial "custom_js" . }}
